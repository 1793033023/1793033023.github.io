<!DOCTYPE html><html><head>
      <title>E2</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////Users/zhanghao/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.6.8/node_modules/@shd101wyy/mume/dependencies/katex/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      pre{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;padding:1em;margin:.5em 0;overflow:auto;line-height:1.5;tab-size:4;hyphens:none;color:#383a42;background-color:#eaeaeb !important;border:#d1d1d2;border-radius:3px}pre[class*="language-"]{padding:1em}code[class*="language-"] .token.comment,pre[class*="language-"] .token.comment,code[class*="language-"] .token.prolog,pre[class*="language-"] .token.prolog,code[class*="language-"] .token.doctype,pre[class*="language-"] .token.doctype,code[class*="language-"] .token.cdata,pre[class*="language-"] .token.cdata{color:#a0a1a7}code[class*="language-"] .namespace,pre[class*="language-"] .namespace{opacity:.7}code[class*="language-"] .token.constant,pre[class*="language-"] .token.constant{color:#986801}code[class*="language-"] .token.boolean,pre[class*="language-"] .token.boolean,code[class*="language-"] .token.number,pre[class*="language-"] .token.number,code[class*="language-"] .token.function-name,pre[class*="language-"] .token.function-name{color:#986801}code[class*="language-"] .token.tag,pre[class*="language-"] .token.tag{color:#e45649}code[class*="language-"] .token.symbol,pre[class*="language-"] .token.symbol{color:#0184bc}code[class*="language-"] .token.selector,pre[class*="language-"] .token.selector{color:#a626a4}code[class*="language-"] .token.attr-name,pre[class*="language-"] .token.attr-name{color:#986801}code[class*="language-"] .token.string,pre[class*="language-"] .token.string{color:#50a14f}code[class*="language-"] .token.char,pre[class*="language-"] .token.char{color:#0184bc}code[class*="language-"] .token.url,pre[class*="language-"] .token.url{color:#0184bc}code[class*="language-"] .token.operator,pre[class*="language-"] .token.operator{color:#383a42}code[class*="language-"] .token.atrule,pre[class*="language-"] .token.atrule,code[class*="language-"] .token.attr-value,pre[class*="language-"] .token.attr-value,code[class*="language-"] .token.keyword,pre[class*="language-"] .token.keyword{color:#a626a4}code[class*="language-"] .token.function,pre[class*="language-"] .token.function{color:#4078f2}code[class*="language-"] .token.class-name,pre[class*="language-"] .token.class-name{color:#c18401}code[class*="language-"] .token.variable,pre[class*="language-"] .token.variable{color:#986801}code[class*="language-"] .token.regex,pre[class*="language-"] .token.regex{color:#0184bc}code[class*="language-"] .token.important,pre[class*="language-"] .token.important{color:#e45649}code[class*="language-"] .token.important,pre[class*="language-"] .token.important,code[class*="language-"] .token.bold,pre[class*="language-"] .token.bold{font-weight:bold}code[class*="language-"] .token.italic,pre[class*="language-"] .token.italic{font-style:italic}code[class*="language-"] .token.entity,pre[class*="language-"] .token.entity{cursor:help}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:rgba(153,122,102,0.08);background:linear-gradient(to right, rgba(153,122,102,0.1) 70%, rgba(153,122,102,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:rgba(153,122,102,0.4);color:#f5f2f0;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px white}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:hsl(230,8%,24%);background-color:hsl(230,1%,98%);overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:hsl(0,0%,0%)}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:hsl(230,8%,40%)}html body strong{color:hsl(0,0%,0%)}html body del{color:hsl(230,8%,40%)}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#0184bc;text-decoration:none}html body a:hover{color:#01a0e5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:hsl(230,8%,40%);background-color:hsl(230,1%,92%);border-left:4px solid hsl(230,1%,82%)}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:hsl(230,1%,82%);border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:hsl(0,0%,0%)}html body table td,html body table th{border:1px solid hsl(230,1%,82%);padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:hsl(0,0%,0%);background-color:hsl(230,1%,92%);border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:hsl(230,1%,82%);border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:hsl(0,0%,0%);border:1px solid hsl(230,1%,82%);border-bottom:2px solid hsl(230,1%,76%);padding:2px 4px;background-color:hsl(230,1%,92%);border-radius:3px}@media print{html body{background-color:hsl(230,1%,98%)}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:hsl(0,0%,0%);page-break-after:avoid}html body blockquote{color:hsl(230,8%,40%)}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p,html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div{display:inline}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  300px/2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header" id="importing-data-from-csv-files-using-tidb-lightning">Importing Data from CSV Files Using TiDB Lightning</h1>

<h3 class="mume-header" id="overview">Overview</h3>

<ul>
<li>In these exercises, you import data from CSV files into TiDB Playground cluster using <code>TiDB Lightning</code>.</li>
</ul>
<h3 class="mume-header" id="notes">Notes</h3>

<ul>
<li>Some of the steps require that you type commands in two different terminal windows. You might find it convenient to launch two terminals and keep them open for the duration of the exercises.</li>
<li>Your environment may be different with these exercises, including but not limited to <code>IP</code>, <code>port</code>, <code>username</code>, <code>password</code> and <code>directory</code>.</li>
<li>The &quot;<code>$</code>&quot; in the terminal window is an OS prompt.</li>
<li>The &quot;<code>tidb&gt;</code>&quot; or &quot;<code>mysql&gt;</code>&quot; in your terminal window is SQL command prompt.</li>
<li>These exercises can be run on a single machine, such as your laptop.</li>
</ul>
<h3 class="mume-header" id="assumptions">Assumptions</h3>

<ul>
<li>You are using macOS or Linux.</li>
<li>You have cloned the <a href="https://github.com/pingcap/tidb-course-201-lab.git">lab repository</a>.</li>
<li>You have completed the Exercises - Creating a TiDB Cluster for Testing Purposes.</li>
</ul>
<h2 class="mume-header" id="exercise-1-importing-data-from-csv-files-into-tidb-in-physical-mode">Exercise 1: Importing Data from CSV Files into TiDB in Physical Mode</h2>

  <img src="./diagram/LightningPhysicalImport2013_aa_001_20230406.png" width="60%" align="top">
<h3 class="mume-header" id="overview-1">Overview</h3>

<ul>
<li>The physical import mode is a highly efficient method for importing data into the storage layer, without using the SQL interface. This mode is especially valuable for importing large data sets of hundreds of terabytes or more.</li>
</ul>
<h3 class="mume-header" id="duration">Duration</h3>

<ul>
<li>This exercise should take you approximately 10 minutes to complete.</li>
</ul>
<h3 class="mume-header" id="tasks">Tasks</h3>

<ol>
<li>Verify the data to be imported.</li>
<li>Verify the <code>TiDB Lightning</code> import task configuration.</li>
<li>Import data into TiDB using <code>TiDB Lightning</code> physical mode.</li>
</ol>
<h3 class="mume-header" id="solution">Solution</h3>

<ol>
<li>
<p>Create a user <code>imp</code> for the data importing task.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ cd tidb-course-201-lab/scripts/
$ ./connect-4000.sh
</code></pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-USER">USER</span> imp<span class="token variable">@&apos;%&apos;</span> IDENTIFIED <span class="token keyword keyword-BY">BY</span> <span class="token string">&apos;q1w2e3R4_&apos;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-GRANT">GRANT</span> <span class="token keyword keyword-ALL">ALL</span> <span class="token keyword keyword-PRIVILEGES">PRIVILEGES</span> <span class="token keyword keyword-ON">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword keyword-TO">TO</span> imp<span class="token variable">@&apos;%&apos;</span><span class="token punctuation">;</span>
<span class="token keyword keyword-EXIT">EXIT</span><span class="token punctuation">;</span>
</pre></li>
<li>
<p>List the contents of the source data directory <code>misc/planets-csv-large-1</code>. Enter the following command at the terminal prompt and receive the results shown.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ ls ./misc/planets-csv-large-1/
total 89632
-rw-r--r--  1 username  staff       100 Apr  6 08:05 universe-schema-create.sql
-rw-r--r--  1 username  staff      1777 Nov  6 14:14 universe.planets-schema.sql
-rw-r--r--  1 username  staff  45109100 Apr  6 18:06 universe.planets.000000000.csv
-rwxr-xr-x  1 username  staff       573 Apr  6 18:06 universe.stars-schema.sql
-rw-rw-r--  1 username  staff       301 Apr  6 18:05 universe.stars.csv
</code></pre></li>
<li>
<p>The SQL script named <code>universe-schema-create.sql</code> is used for creating the <code>universe</code> schema.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ cat ./misc/planets-csv-large-1/universe-schema-create.sql
</code></pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-DATABASE">DATABASE</span> <span class="token punctuation">`</span>universe<span class="token punctuation">`</span>
<span class="token comment">/*!40100 DEFAULT CHARACTER SET utf8mb4 */</span>
<span class="token punctuation">;</span>
</pre></li>
<li>
<p>The SQL script named <code>universe.planets-schema.sql</code> is used for creating the <code>planets</code> table.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ cat ./misc/planets-csv-large-1/universe.planets-schema.sql 
</code></pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TABLE">TABLE</span> <span class="token punctuation">`</span>planets<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword keyword-bigint">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-AUTO_INCREMENT">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>mass<span class="token punctuation">`</span> <span class="token keyword keyword-float">float</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0.0&apos;</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;10**24 kg&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>diameter<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0&apos;</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;km&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>density<span class="token punctuation">`</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0&apos;</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;kg/m**3&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gravity<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0.0&apos;</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;m/s**2&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>escape_velocity<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0.0&apos;</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;km/s&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>rotation_period<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0.0&apos;</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;hours&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>length_of_day<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0.0&apos;</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;hours&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>distance_from_sun<span class="token punctuation">`</span> <span class="token keyword keyword-float">float</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0.0&apos;</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;10**6 km&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>perihelion<span class="token punctuation">`</span> <span class="token keyword keyword-float">float</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;10**6 km&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>aphelion<span class="token punctuation">`</span> <span class="token keyword keyword-float">float</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;10**6 km&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>orbital_period<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0.0&apos;</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;days&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>orbital_velocity<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;km/s&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>orbital_inclination<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;degrees&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>orbital_eccentricity<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0.0&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>obliquity_to_orbit<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;degrees&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>mean_temperature<span class="token punctuation">`</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0&apos;</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;C&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>surface_pressure<span class="token punctuation">`</span> <span class="token keyword keyword-float">float</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;bars&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>ring_systems<span class="token punctuation">`</span> <span class="token keyword keyword-tinyint">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>global_magnetic_field<span class="token punctuation">`</span> <span class="token keyword keyword-tinyint">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;0&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>sun_id<span class="token punctuation">`</span> <span class="token keyword keyword-bigint">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>category_id<span class="token punctuation">`</span> <span class="token keyword keyword-int">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>discover_date<span class="token punctuation">`</span> <span class="token keyword keyword-datetime">datetime</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword keyword-PRIMARY">PRIMARY</span> <span class="token keyword keyword-KEY">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token comment">/*T![clustered_index] CLUSTERED */</span><span class="token punctuation">,</span>
  <span class="token keyword keyword-KEY">KEY</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword keyword-CONSTRAINT">CONSTRAINT</span> <span class="token punctuation">`</span>planet_sun_fk<span class="token punctuation">`</span> <span class="token keyword keyword-FOREIGN">FOREIGN</span> <span class="token keyword keyword-KEY">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>sun_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword keyword-REFERENCES">REFERENCES</span> <span class="token punctuation">`</span>stars<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword keyword-CONSTRAINT">CONSTRAINT</span> <span class="token punctuation">`</span>planet_cat_fk<span class="token punctuation">`</span> <span class="token keyword keyword-FOREIGN">FOREIGN</span> <span class="token keyword keyword-KEY">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>category_id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword keyword-REFERENCES">REFERENCES</span> <span class="token punctuation">`</span>planet_categories<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword keyword-ENGINE">ENGINE</span><span class="token operator">=</span><span class="token keyword keyword-InnoDB">InnoDB</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token keyword keyword-CHARSET">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword keyword-COLLATE">COLLATE</span><span class="token operator">=</span>utf8mb4_bin <span class="token keyword keyword-AUTO_INCREMENT">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">40510553</span><span class="token punctuation">;</span>
</pre></li>
<li>
<p>The SQL script named <code>universe.stars-schema.sql</code> is used for creating the <code>stars</code> table.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ cat ./misc/planets-csv-large-1/universe.stars-schema.sql
</code></pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword keyword-CREATE">CREATE</span> <span class="token keyword keyword-TABLE">TABLE</span> <span class="token punctuation">`</span>stars<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword keyword-bigint">bigint</span> AUTO_RANDOM<span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>mass<span class="token punctuation">`</span> <span class="token keyword keyword-float">float</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token number">0.0</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;10**24 kg&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>density<span class="token punctuation">`</span> <span class="token keyword keyword-int">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token number">0</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;kg/m**3&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>gravity<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token number">0.0</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;m/s**2&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>escape_velocity<span class="token punctuation">`</span> <span class="token keyword keyword-decimal">decimal</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;km/s&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>mass_conversion_rate<span class="token punctuation">`</span> <span class="token keyword keyword-int">int</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;10**6 kg/s&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>spectral_type<span class="token punctuation">`</span> <span class="token keyword keyword-char">char</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token string">&apos;&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>distance_from_earth<span class="token punctuation">`</span> <span class="token keyword keyword-float">float</span> <span class="token keyword keyword-COMMENT">COMMENT</span> <span class="token string">&apos;light year&apos;</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>discover_date<span class="token punctuation">`</span> <span class="token keyword keyword-datetime">datetime</span> <span class="token keyword keyword-DEFAULT">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword keyword-PRIMARY">PRIMARY</span> <span class="token keyword keyword-KEY">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword keyword-KEY">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></li>
<li>
<p>Verify that the files <code>universe.planets.000000000.csv</code> and <code>universe.stars.csv</code> contain 327681 and 3 rows respectively. These files are for demonstration purposes only and do not contain the real-world data.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ head -5 ./misc/planets-csv-large-1/universe.planets.000000000.csv 
&quot;id&quot;,&quot;name&quot;,&quot;mass&quot;,&quot;diameter&quot;,&quot;density&quot;,&quot;gravity&quot;,&quot;escape_velocity&quot;,&quot;rotation_period&quot;,&quot;length_of_day&quot;,&quot;distance_from_sun&quot;,&quot;perihelion&quot;,&quot;aphelion&quot;,&quot;orbital_period&quot;,&quot;orbital_velocity&quot;,&quot;orbital_inclination&quot;,&quot;orbital_eccentricity&quot;,&quot;obliquity_to_orbit&quot;,&quot;mean_temperature&quot;,&quot;surface_pressure&quot;,&quot;ring_systems&quot;,&quot;global_magnetic_field&quot;,&quot;sun_id&quot;,&quot;category_id&quot;,&quot;discover_date&quot;
1,&quot;Mercury&quot;,0.33,4879.00,5429,3.7,4.3,1407.6,4222.6,57.9,46,69.8,88.0,47.4,7.0,0,0.0340,167,0,0,1,7782220156096217089,1,\N
2,&quot;Venus&quot;,4.87,12104.00,5234,8.9,10.4,-5832.5,2802.0,108.2,107.5,108.9,224.7,35.0,3.4,0,177.4000,464,92,0,0,7782220156096217089,1,\N
3,&quot;Earth&quot;,5.97,12756.00,5514,9.8,11.2,23.9,24.0,149.6,147.1,152.1,365.2,29.8,0.0,0,23.4000,15,1,0,1,7782220156096217089,1,\N
4,&quot;Mars&quot;,0.642,6792.00,3934,3.7,5.0,24.6,24.7,228,206.7,249.3,687.0,24.1,1.8,0,25.2000,-65,0.01,0,0,7782220156096217089,1,\N
</code></pre><pre data-role="codeBlock" data-info class="language-"><code>$ wc -l ./misc/planets-csv-large-1/universe.planets.000000000.csv
      327681 ./misc/planets-csv-large-1/universe.planets.000000000.csv
</code></pre><pre data-role="codeBlock" data-info class="language-"><code>$ head -5 ./misc/planets-csv-large-1/universe.stars.csv 
&quot;id&quot;,&quot;name&quot;,&quot;mass&quot;,&quot;density&quot;,&quot;gravity&quot;,&quot;escape_velocity&quot;,&quot;mass_conversion_rate&quot;,&quot;spectral_type&quot;,&quot;distance_from_earth&quot;,&quot;discover_date&quot;
1,&quot;Sun&quot;,1988500,1408,274.0000,617.6,4260,&quot;G2 V&quot;,0.0000158,\N
3170534137668829186,&quot;Proxima Centauri&quot;,244600,56800,0.0520,\N,\N,&quot;M5.5 Ve&quot;,4.426,&quot;1915-01-01 00:00:00&quot;
</code></pre><pre data-role="codeBlock" data-info class="language-"><code>$ wc -l ./misc/planets-csv-large-1/universe.stars.csv
      3 ./misc/planets-csv-large-1/universe.stars.csv
</code></pre></li>
<li>
<p>Review the content of the provided <code>TiDB Lightning</code> task configuration file and take note that the value of the <code>backend</code> attribute in section <code>[tikv-importer]</code> is set to <code>local</code>. This configuration indicates that <code>TiDB Lightning</code> is operating in physical mode, importing data directly into the storage layer without passing through the SQL layer. Ensure that the <code>data-source-dir</code> attribute located under the <code>[mydumper]</code> section is correctly pointing to the <code>./misc/planets-csv-large-1</code> directory and the credentials under section <code>[tidb]</code> are the same as the ones created for the user in step 1.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ cat ./misc/lightning-universe-planets-csv-physical.toml 
[lightning]
level = &quot;info&quot;
file = &quot;../stage/tidb-lightning-universe.log&quot;
table-concurrency = 1
index-concurrency = 1
region-concurrency = 1
io-concurrency = 1
max-error = 0
task-info-schema-name = &quot;lightning_task_info&quot;
meta-schema-name = &quot;lightning_metadata&quot;

[checkpoint]
enable = true
driver = &quot;file&quot;
dsn = &quot;/tmp/tidb_lightning_checkpoint_physical.pb&quot;

[tikv-importer]
backend = &quot;local&quot;
incremental-import = false
sorted-kv-dir = &quot;../stage/sorted-kv-dir-1&quot;

[mydumper]
data-source-dir = &quot;./misc/planets-csv-large-1&quot;
filter = [&apos;*.*&apos;, &apos;!mysql.*&apos;, &apos;!sys.*&apos;, &apos;!INFORMATION_SCHEMA.*&apos;, &apos;!PERFORMANCE_SCHEMA.*&apos;, &apos;!METRICS_SCHEMA.*&apos;, &apos;!INSPECTION_SCHEMA.*&apos;]
strict-format = true

[mydumper.csv]
separator = &apos;,&apos;
delimiter = &apos;&quot;&apos;
terminator = &apos;&apos;
header = true
not-null = false
null = &apos;\N&apos;
backslash-escape = true
trim-last-separator = false

[tidb]
host = &quot;127.0.0.1&quot;
port = 4000
user = &quot;imp&quot;
password = &quot;q1w2e3R4_&quot;
status-port = 10080
pd-addr = &quot;127.0.0.1:2379&quot;
</code></pre></li>
<li>
<p>Initiate the import task. Enter the following command at the terminal prompt and receive the results shown. Since the environment is TiDB Playground cluster, ignore the warning in check item 7.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ tiup tidb-lightning --config ./misc/lightning-universe-planets-csv-physical.toml 
...

+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
|  # | CHECK ITEM                                                                                                                         | TYPE        | PASSED |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
|  1 | Skip the csv size check, because config.StrictFormat is true                                                                       | performance | true   |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
|  2 | the checkpoints are valid                                                                                                          | critical    | true   |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
|  3 | table schemas are valid                                                                                                            | critical    | true   |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
|  4 | all importing tables on the target are empty                                                                                       | critical    | true   |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
|  5 | Cluster version check passed                                                                                                       | critical    | true   |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
|  6 | Lightning has the correct storage permission                                                                                       | critical    | true   |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
|  7 | sorted-kv-dir:../stage/sorted-kv-dir-1 and data-source-dir:/Users/username/git/github/tidb-course-201-lab/scripts/misc/planets-csv | performance | false  |
|    | -large-1 are in the same disk, may slow down performance                                                                           |             |        |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
|  8 | local disk resources are rich, estimate sorted data size 14.34MiB, local available is 103.5GiB                                     | critical    | true   |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
|  9 | The storage space is rich, which TiKV/Tiflash is 310.5GiB/103.5GiB. The estimated storage space is 14.34MiB/0B.                    | performance | true   |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
| 10 | Cluster doesn&apos;t have too many empty regions                                                                                        | performance | true   |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
| 11 | Cluster region distribution is balanced                                                                                            | critical    | true   |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+
| 12 | no CDC or PiTR task found                                                                                                          | critical    | true   |
+----+------------------------------------------------------------------------------------------------------------------------------------+-------------+--------+

tidb lightning exit successfully
</code></pre></li>
<li>
<p>(Optional) If any problems related to inaccurate configuration were encountered during the previous step, this error message may be encountered when re-executing the import task - <code>Checkpoint for ... has invalid status</code>. Note that <a href="https://pingcap.com/education/">PingCAP Training and Certification</a> provides a private training course <em>TiDB Administration</em> that contains detailed instructions and hands-on labs on how to use tools related to TiDB cluster administration, such as TiDB Lightning, Dumping, TiDB Data Migration, etc.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ rm /tmp/tidb_lightning_checkpoint_physical.pb
</code></pre></li>
<li>
<p>Verify that the data has been imported.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ ./connect-4000.sh
</code></pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword keyword-FROM">FROM</span> universe<span class="token punctuation">.</span>planets<span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword keyword-FROM">FROM</span> universe<span class="token punctuation">.</span>stars<span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info class="language-"><code>...
+----------+
| COUNT(*) |
+----------+
|   327680 |
+----------+
...
+----------+
| COUNT(*) |
+----------+
|        2 |
+----------+
...
</code></pre></li>
</ol>
<h2 class="mume-header" id="exercise-2-importing-data-from-csv-files-into-tidb-in-logical-mode">Exercise 2: Importing Data from CSV Files into TiDB in Logical Mode</h2>

  <img src="./diagram/2013E022_aa_001_20230406.png" width="60%" align="top">
<h3 class="mume-header" id="overview-2">Overview</h3>

<ul>
<li>During the logical import mode, TiDB Lightning encodes the data into SQL statements and subsequently executes them to import data.</li>
</ul>
<h3 class="mume-header" id="duration-1">Duration</h3>

<ul>
<li>This exercise should take you approximately 5 minutes to complete.</li>
</ul>
<h3 class="mume-header" id="tasks-1">Tasks.</h3>

<ol>
<li>Verify the <code>TiDB Lightning</code> import task configuration.</li>
<li>Import data into TiDB using <code>TiDB Lightning</code> physical mode.</li>
</ol>
<h3 class="mume-header" id="solution-1">Solution</h3>

<ol>
<li>
<p>Truncate both tables imported previously:</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ cd tidb-course-201-lab/scripts/
$ ./connect-4000.sh
</code></pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword keyword-TRUNCATE">TRUNCATE</span> universe<span class="token punctuation">.</span>planets<span class="token punctuation">;</span>
<span class="token keyword keyword-TRUNCATE">TRUNCATE</span> universe<span class="token punctuation">.</span>stars<span class="token punctuation">;</span>
<span class="token keyword keyword-EXIT">EXIT</span><span class="token punctuation">;</span>
</pre></li>
<li>
<p>Review the content of the provided <code>TiDB Lightning</code> task configuration file and take note that the value of the <code>backend</code> attribute in section <code>[tikv-importer]</code> is set to <code>tidb</code>. This configuration indicates that <code>TiDB Lightning</code> is operating in logical mode.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ cat ./misc/lightning-universe-planets-csv-logical.toml 
[lightning]
level = &quot;info&quot;
file = &quot;../stage/tidb-lightning-universe.log&quot;
table-concurrency = 1
index-concurrency = 1
region-concurrency = 1
io-concurrency = 1
max-error = 0
task-info-schema-name = &quot;lightning_task_info&quot;
meta-schema-name = &quot;lightning_metadata&quot;

[checkpoint]
enable = true
driver = &quot;file&quot;
dsn = &quot;/tmp/tidb_lightning_checkpoint_physical.pb&quot;

[tikv-importer]
backend = &quot;tidb&quot;
incremental-import = false
sorted-kv-dir = &quot;../stage/sorted-kv-dir-1&quot;

[mydumper]
data-source-dir = &quot;./misc/planets-csv-large-1&quot;
filter = [&apos;*.*&apos;, &apos;!mysql.*&apos;, &apos;!sys.*&apos;, &apos;!INFORMATION_SCHEMA.*&apos;, &apos;!PERFORMANCE_SCHEMA.*&apos;, &apos;!METRICS_SCHEMA.*&apos;, &apos;!INSPECTION_SCHEMA.*&apos;]
strict-format = true

[mydumper.csv]
separator = &apos;,&apos;
delimiter = &apos;&quot;&apos;
terminator = &apos;&apos;
header = true
not-null = false
null = &apos;\N&apos;
backslash-escape = true
trim-last-separator = false

[tidb]
host = &quot;127.0.0.1&quot;
port = 4000
user = &quot;imp&quot;
password = &quot;q1w2e3R4_&quot;
status-port = 10080
pd-addr = &quot;127.0.0.1:2379&quot;
</code></pre></li>
<li>
<p>Initiate the import task. Enter the following command at the terminal prompt and receive the results shown.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ tiup tidb-lightning --config ./misc/lightning-universe-planets-csv-logical.toml
...

+---+--------------------------------------------------------------+-------------+--------+
| # | CHECK ITEM                                                   | TYPE        | PASSED |
+---+--------------------------------------------------------------+-------------+--------+
| 1 | Skip the csv size check, because config.StrictFormat is true | performance | true   |
+---+--------------------------------------------------------------+-------------+--------+
| 2 | the checkpoints are valid                                    | critical    | true   |
+---+--------------------------------------------------------------+-------------+--------+
| 3 | Cluster version check passed                                 | critical    | true   |
+---+--------------------------------------------------------------+-------------+--------+
| 4 | Lightning has the correct storage permission                 | critical    | true   |
+---+--------------------------------------------------------------+-------------+--------+

tidb lightning exit successfully
</code></pre></li>
<li>
<p>Verify that the data has been imported.</p>
<pre data-role="codeBlock" data-info class="language-"><code>$ ./connect-4000.sh
</code></pre><pre data-role="codeBlock" data-info="sql" class="language-sql"><span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword keyword-FROM">FROM</span> universe<span class="token punctuation">.</span>planets<span class="token punctuation">;</span>
<span class="token keyword keyword-SELECT">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword keyword-FROM">FROM</span> universe<span class="token punctuation">.</span>stars<span class="token punctuation">;</span>
</pre><pre data-role="codeBlock" data-info class="language-"><code>...
+----------+
| COUNT(*) |
+----------+
|   327680 |
+----------+
...
+----------+
| COUNT(*) |
+----------+
|        2 |
+----------+
...
</code></pre></li>
<li>
<p>In production, it is not uncommon for TiDB Lightning to efficiently handle the import of tens of terabytes of data into TiDB, especially when it comes to migration. If you are interested in conducting a production-level test or demo, <a href="https://www.pingcap.com/demo/?utm_source=edu&amp;utm_medium=referral&amp;utm_campaign=201.3.E2">click here</a> to apply.</p>
</li>
</ol>
<h2 class="mume-header" id="additional-information">Additional Information</h2>

<p>Apart from CSV files, TiDB Lightning is also capable of importing data from Mydumper SQL files, Parquet files that have been exported from Amazon Aurora or Apache Hive. Refer to the TiDB documentation for further details regarding <a href="https://docs.pingcap.com/tidb/stable/tidb-lightning-overview">TiDB Lightning</a>.</p>
<h2 class="mume-header" id="end-of-exercises">End of Exercises</h2>


      </div>
      <div class="md-sidebar-toc">
<div class="md-toc">
<details style="padding:0;;padding-left:0px;" open>
        <summary class="md-toc-link-wrapper">
          <a href="#importing-data-from-csv-files-using-tidb-lightning" class="md-toc-link"><p>Importing Data from CSV Files Using TiDB Lightning</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open>
        <summary class="md-toc-link-wrapper">
          <a href="#exercise-1-importing-data-from-csv-files-into-tidb-in-physical-mode" class="md-toc-link"><p>Exercise 1: Importing Data from CSV Files into TiDB in Physical Mode</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#overview-1" class="md-toc-link">
            <p>Overview</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#duration" class="md-toc-link">
            <p>Duration</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#tasks" class="md-toc-link">
            <p>Tasks</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#solution" class="md-toc-link">
            <p>Solution</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open>
        <summary class="md-toc-link-wrapper">
          <a href="#exercise-2-importing-data-from-csv-files-into-tidb-in-logical-mode" class="md-toc-link"><p>Exercise 2: Importing Data from CSV Files into TiDB in Logical Mode</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#overview-2" class="md-toc-link">
            <p>Overview</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#duration-1" class="md-toc-link">
            <p>Duration</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#tasks-1" class="md-toc-link">
            <p>Tasks.</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#solution-1" class="md-toc-link">
            <p>Solution</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#additional-information" class="md-toc-link">
            <p>Additional Information</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#end-of-exercises" class="md-toc-link">
            <p>End of Exercises</p>

          </a></div>
        </div>
      </details>
    
</div>
</div>
      <a id="sidebar-toc-btn">&#x2261;</a>
    
    
    
    
    
    
    
    
<script>
document.body.setAttribute('html-show-sidebar-toc', true)
var sidebarTOCBtn = document.getElementById('sidebar-toc-btn')
sidebarTOCBtn.addEventListener('click', function(event) {
  event.stopPropagation()
  if (document.body.hasAttribute('html-show-sidebar-toc')) {
    document.body.removeAttribute('html-show-sidebar-toc')
  } else {
    document.body.setAttribute('html-show-sidebar-toc', true)
  }
})
</script>
      
  
    </body></html>